!function(e,t){var i={init:function(){e(document).ready(i.ready),e(window).on("load",i.load),i.bindUI()},load:function(){},bindUI:function(){i.bindDefaultTabs(),i.checkEmptyGrid(),i.bindFields(),i.bindFormPreview(),i.bindGridSwitcher(),i.bindFieldSettings(),i.bindFieldDelete(),i.bindCloneField(),i.bindSaveOption(),i.bindFieldOptionChange(),i.bindAddNewRow(),i.bindRemoveRow(),i.bindFormSettings(),i.choicesInit(),i.choicesUpdate();"field-options"===t.tab&&e(".evf-panel-field-options-button").trigger("click")},choicesInit:function(){var t=e(".evf-choices-list");t.sortable({out:function(t,n){var o=e(t.target).attr("data-field-id");i.choiceChange(o)}});var n=t.closest(".everest-forms-field-option").attr("data-field-id");e("#everest-forms-field-"+n)},choicesUpdate:function(){e(".evf-choices-list");e("body").on("click",".evf-choices-list a.add",function(){var t=e(this).closest("li").clone();t.find('input[type="text"]').val("");var n=e(this).closest(".evf-choices-list"),o=n.attr("data-field-id"),r=n.find("li").length;r++,t.find('input[type="checkbox"],input[type="radio"]').prop("checked",!1),t.attr("data-key",r),t.find(".default").attr("name","form_fields["+o+"][choices]["+r+"][default]"),t.find(".label").attr("name","form_fields["+o+"][choices]["+r+"][label]"),t.find(".value").attr("name","form_fields["+o+"][choices]["+r+"][value]"),e(this).closest("li").after(t),i.choiceChange(o)}),e("body").on("click",".evf-choices-list a.remove",function(){var n=e(this).closest(".evf-choices-list"),o=n.attr("data-field-id");if(n.find("li").length<2){var r=t.delete_confirm_title,s=t.are_you_sure_want_to_delete_row,a={ok:{text:t.ok,btnClass:"evf-ok-btn",action:function(){}}};return"red",r=t.could_not_delete_single_choice,s=t.could_not_delete_single_choice_content,void e.confirm({columnClass:"evf-responsive-class",type:"red",typeAnimated:!0,boxWidth:"400px",useBootstrap:!1,title:r,content:s,buttons:a})}e(this).closest("li").remove(),i.choiceChange(o)});e("body").on("keyup paste click",".evf-choices-list input",function(){var t=e(this).closest(".evf-choices-list").attr("data-field-id");"radio"===e(this).attr("type").toLowerCase()&&e(this).is(":checked")&&(e(this).closest(".evf-choices-list").find('input[type="radio"]').prop("checked",!1),e(this).prop("checked",!0)),i.choiceChange(t)})},choiceChange:function(t){var i=e("#everest-forms-field-option-row-"+t+"-choices"),n=e("#everest-forms-field-"+t),o=n.find("ul.primary-input"),r=i.find("ul.evf-choices-list").attr("data-field-type");"select"===r&&(o=n.find("select.primary-input")),o.html(""),e.each(i.find("ul.evf-choices-list").find("li"),function(){var t=e(this).find(".default").attr("type"),i=e("<li/>").append('<input type="'+t+'" disabled="">');"select"===r&&(i=e("<option/>"),e(this).find(".default").is(":checked")&&i.attr("selected","selected")),i.append(e(this).find(".label").val()),e(this).find(".default").is(":checked")&&i.find("input").prop("checked",!0),o.append(i)})},bindFormSettings:function(){e("body").on("click",".evf-setting-panel",function(t){var i=e(this).attr("data-section");e(".evf-setting-panel").removeClass("active"),e(".evf-content-section").removeClass("active"),e(this).addClass("active"),e(".evf-content-"+i+"-settings").addClass("active"),t.preventDefault()}),e(".evf-setting-panel").eq(0).trigger("click")},removeRow:function(t){e.each(t.find(".everest-forms-field"),function(){var t=e(this),i=t.attr("data-field-id"),n=e("#everest-forms-field-option-"+i);t.remove(),n.remove()}),t.remove()},bindRemoveRow:function(){e("body").on("click",".evf-delete-row",function(){var n=e(this).closest(".evf-admin-row"),o={confirm:{text:t.confirm,btnClass:"evf-confirm-btn",action:function(){i.removeRow(n)}},cancel:{text:t.cancel,btnClass:"evf-cancel-btn",action:function(){}}},r="",s=t.delete_confirm_title,a=t.are_you_sure_want_to_delete_row;e(".evf-admin-row").length<2&&(o={ok:{text:t.ok,btnClass:"evf-ok-btn",action:function(){}}},r="red",s=t.could_not_delete_single_row_title,a=t.could_not_delete_single_row_content),e.confirm({columnClass:"evf-responsive-class",type:r,typeAnimated:!0,boxWidth:"400px",useBootstrap:!1,title:s,content:a,buttons:o})})},bindAddNewRow:function(){e("body").on("click",".evf-add-row span",function(){var t=e(".evf-admin-row").eq(0).clone(),n=e(".evf-admin-row").length;t.find(".evf-admin-grid").html(""),t.attr("data-row-id",n+1),e(".evf-admin-field-wrapper").append(t),i.bindFields(),i.checkEmptyGrid()})},bindFieldOptionChange:function(){e("body").on("keyup paste click",'.everest-forms-field-option-row input[type="text"][name$="[label]"], .everest-forms-field-option-row textarea[name$="[description]"], .everest-forms-field-option-row input[type="checkbox"][name$="[required]"], .everest-forms-field-option-row input[type="checkbox"][name$="[label_hide]"], .everest-forms-field-option-row input[type="text"][name$="[placeholder]"]',function(){i.bindFormFieldChange(e(this))})},bindFormFieldChange:function(t){var i=t.closest(".everest-forms-field-option-row").attr("data-field-id"),n=e(".evf-admin-grid #everest-forms-field-"+i+".active"),o=t.attr("id");if("undefined"!==o&&o!==undefined)switch(o=o.replace("everest-forms-field-option-"+i+"-","")){case"label":n.find(".label-title .text").text(t.val());break;case"description":n.find(".description").text(t.val());break;case"required":t.is(":checked")?(n.find(".label-title .required").remove(),n.find(".label-title").append('<span class="required">*</span>')):n.find(".label-title .required").remove();break;case"label_hide":t.is(":checked")?n.find(".label-title").hide():n.find(".label-title").show();break;case"placeholder":n.find("input").attr("placeholder",t.val())}},bindCloneField:function(){e("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-duplicate",function(){var n=e(this).closest(".everest-forms-field"),o=n.find(".label-title span.text").text();e.confirm({columnClass:"evf-responsive-class",boxWidth:"400px",useBootstrap:!1,title:t.duplicate_confirm_title,content:t.are_you_sure_want_to_duplicate_this+" <b>"+o+"</b> "+t.field+" ?",buttons:{confirm:{text:t.confirm,btnClass:"evf-confirm-btn",action:function(){i.cloneFieldAction(n)}},cancel:{text:t.cancel,btnClass:"evf-cancel-btn",action:function(){}}}})})},cloneFieldAction:function(n){var o=n.attr("data-field-id"),r=t.form_id,s={action:"everest_forms_get_next_id",security:t.evf_get_next_id,form_id:r};e.ajax({url:t.ajax_url,data:s,type:"POST",beforeSend:function(){},success:function(t){if("boolean"==typeof t.success&&!0===t.success){var r=t.data.field_id,s=t.data.field_key;e("#everest-forms-field-id").val(r),i.render_node(n,o,s)}}})},render_node:function(i,n,o){var r=e(".everest-forms-field-options #everest-forms-field-option-"+n),s=i.attr("data-field-type"),a=r.html(),d=t.copy_of+e("#everest-forms-field-option-"+n+"-label").val(),l=i.clone(),f=new RegExp(n,"g");a=a.replace(f,o);var c=e('<div class="everest-forms-field-option everest-forms-field-option-'+s+'" id="everest-forms-field-option-'+o+'" data-field-id="'+o+'" />');c.append(a),e.each(r.find(":input"),function(){var t=e(this).attr("type"),i=e(this).attr("name").replace(f,o),r="";if("text"===t||"hidden"===t)r=e(this).val(),c.find('input[name="'+i+'"]').val(r),c.find('input[value="'+n+'"]').val(o);else if("checkbox"===t||"radio"===t)e(this).is(":checked")?c.find('input[name="'+i+'"]').prop("checked",!0).attr("checked","checked"):c.find('[name="'+i+'"]').prop("checked",!1).attr("checked",!1);else if(e(this).is("select")){if(e(this).find("option:selected").length){var s=e(this).find("option:selected").val();c.find('[name="'+i+'"]').find('[value="'+s+'"]').prop("selected",!0)}}else""!==e(this).val()&&c.find('[name="'+i+'"]').val(e(this).val())}),e(".everest-forms-field-options").append(c),e("#everest-forms-field-option-"+o+"-label").val(d),l.attr("class",i.attr("class")),l.attr("id","everest-forms-field-"+o),l.attr("data-field-id",o),l.attr("data-field-type",s),l.find(".label-title .text").text(d),i.closest(".evf-admin-grid").append(l),e(document).trigger("everest-form-cloned",[o,type])},bindFieldDelete:function(){e("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-delete",function(){var i=e(this).closest(".everest-forms-field"),n=i.attr("data-field-id"),o=e("#everest-forms-field-option-"+n),r=i.find(".label-title span.text").text();e.confirm({columnClass:"evf-responsive-class",boxWidth:"400px",useBootstrap:!1,title:t.delete_confirm_title,content:t.are_you_sure_want_to_delete_this+" <b>"+r+"</b> "+t.field+" ?",buttons:{confirm:{text:t.confirm,btnClass:"evf-confirm-btn",action:function(){e(".evf-panel-fields-button").trigger("click"),i.fadeOut("slow",function(){i.remove(),o.remove()})}},cancel:{text:t.cancel,btnClass:"evf-cancel-btn",action:function(){}}}})})},bindSaveOption:function(){e("body").on("click",".evf_save_form_action_button",function(){var n=e(this),o=e("form#everest-forms-builder-form"),r=i.getStructure(),s=o.serializeArray().concat(r),a={action:"everest_forms_save_form",security:t.evf_save_form,form_data:JSON.stringify(s)},d=e("#everest-forms-builder");e.ajax({url:t.ajax_url,data:a,type:"POST",beforeSend:function(){evfHelper.startEvfOverLay(d,n)},success:function(e){evfHelper.endEvfOverLay(d,n),"boolean"==typeof e.success&&!0===e.success&&window.location.reload()}})})},getStructure:function(){var t=e(".evf-admin-field-wrapper"),i=[];return e.each(t.find(".evf-admin-row"),function(){var t=e(this),n=t.attr("data-row-id");e.each(t.find(".evf-admin-grid"),function(){var t=e(this),o=t.attr("data-grid-id"),r=0;e.each(t.find(".everest-forms-field"),function(){var t={name:"",value:""},s=e(this).attr("data-field-id");t.name="structure[row_"+n+"][grid_"+o+"]["+r+"]",r++,t.value=s,i.push(t)}),t.find(".everest-forms-field").length<1&&i.push({name:"structure[row_"+n+"][grid_"+o+"]",value:""})})}),i},getFieldArray:function(t){var i=[];return e.each(t.find(".everest-forms-field"),function(){var t=e(this).attr("data-field-id");i.push(t)}),i},checkEmptyGrid:function(){e.each(e(".evf-admin-grid"),function(){e(this).find(".everest-forms-field").length<1?e(this).addClass("evf-empty-grid"):e(this).removeClass("evf-empty-grid")}),i.choicesInit()},bindDefaultTabs:function(){e(document).on("click","#evf-builder-tabs li",function(t){t.preventDefault(),i.switchTab(e(this).data("panel"))})},switchTab:function(t){var n=e("#everest-forms-panel-"+t),o=e(".evf-panel-"+t+"-button");e("#evf-builder-tabs").find("li a").removeClass("active"),o.find("a").addClass("active"),n.closest(".evf-tab-content").find(".everest-forms-panel").removeClass("active"),n.addClass("active"),"fields"===t&&(e(".everest-forms-field-options").hide(),e(".everest-forms-add-fields").show()),history.replaceState({},null,evfHelper.updateQueryString("tab",t)),i.switchPanel(t)},switchPanel:function(e){"field-options"===e&&i.switchToFieldOptionPanel()},switchToFieldOptionPanel:function(t){e("li.evf-panel-field-options-button.evf-disabled-tab").show(),e(".everest-forms-field-options").find(".no-fields").hide(),e(".evf-admin-field-wrapper .everest-forms-field").removeClass("active"),e(".everest-forms-panel").removeClass("active"),e("#everest-forms-panel-fields").addClass("active"),e(".everest-forms-add-fields").hide(),e(".everest-forms-field-options").show(),e(".everest-forms-field-options").find(".everest-forms-field-option").hide(),e(".evf-tab-lists").find("li a").removeClass("active"),e(".evf-tab-lists").find("li.evf-panel-field-options-button a").addClass("active"),void 0!==t?(e("#everest-forms-field-option-"+t).show(),e("#everest-forms-field-"+t).addClass("active")):e(".evf-admin-field-wrapper .everest-forms-field").length>0?(e(".evf-admin-field-wrapper .everest-forms-field").eq(0).addClass("active"),e("#everest-forms-field-option-"+e(".evf-admin-field-wrapper .everest-forms-field").eq(0).attr("data-field-id")).show()):e(".everest-forms-field-options").find(".no-fields").show()},bindFields:function(){e(".evf-admin-grid").sortable({containment:".evf-admin-field-wrapper",cancel:!1,over:function(t,n){e(t.target).addClass("evf-item-hover"),e(".evf-admin-grid").addClass("evf-hover"),i.checkEmptyGrid()},out:function(t,n){e(".evf-admin-grid").removeClass("evf-hover"),e(t.target).removeClass("evf-item-hover"),i.checkEmptyGrid()},revert:!0,connectWith:".evf-admin-grid"}).disableSelection(),e(".evf-admin-field-wrapper").sortable({containment:".evf-admin-field-wrapper",tolerance:"pointer",revert:"invalid",placeholder:"evf-admin-row",forceHelperSize:!0,over:function(){e(".evf-admin-field-wrapper").addClass("evf-hover")},out:function(){e(".evf-admin-field-wrapper").removeClass("evf-hover")}}),e(".evf-registered-buttons button.evf-registered-item").draggable({connectToSortable:".evf-admin-grid",containment:"#everest-forms-builder",helper:"clone",revert:"invalid",cancel:!1,start:function(t,i){e(".evf-admin-grid").addClass("evf-hover")},stop:function(t,n){e(".evf-admin-grid").removeClass("evf-hover");n.helper.closest(".evf-admin-grid");var o=n.helper;i.fieldDrop(o)}}).disableSelection()},bindFormPreview:function(){},bindGridSwitcher:function(){e("body").on("click",".evf-show-grid",function(){e(this).closest(".evf-toggle-row").find(".evf-toggle-row-content").slideToggle(200)});e("body").on("click",".evf-grid-selector",function(){var t=e(this).closest(".evf-admin-row");if(!e(this).hasClass("active")){var n=evfHelper.parseInt(e(this).attr("data-evf-grid"));if(!(n>2)){var o=e('<div class="evf-admin-grid evf-grid-'+n+' ui-sortable" />'),r=e("<div/>");e.each(t.find(".evf-admin-grid"),function(){e(this).children("*").each(function(){r.append(e(this).clone())})}),t.find(".evf-admin-grid").remove(),t.find(".evf-clear ").remove(),t.append('<div class="clear evf-clear"></div>');for(var s=1;s<=n;s++)o.attr("data-grid-id",s),t.append(o.clone());t.append('<div class="clear evf-clear"></div>'),t.find(".evf-admin-grid").eq(0).append(r.html()),t.find(".evf-grid-selector").removeClass("active"),e(this).addClass("active"),i.bindFields()}}})},fieldDrop:function(n){var o=n.attr("data-field-type");n.css({width:"100%",left:"0"}),n.append('<i class="spinner is-active" style="margin: 0;padding: 0;"></i>');var r={action:"everest_forms_new_field_"+o,security:t.evf_field_drop_nonce,field_type:o,form_id:t.form_id};e.ajax({url:t.ajax_url,data:r,type:"POST",beforeSend:function(){},success:function(t){var o=t.data.preview,r=t.data.options,s=t.data.form_field_id;e("#everest-forms-field-id").val(s),e(".everest-forms-field-options").find(".no-fields").hide(),e(".everest-forms-field-options").append(r),n.after(o),n.remove(),i.checkEmptyGrid()}})},bindFieldSettings:function(){e("body").on("click",".everest-forms-preview .everest-forms-field, .everest-forms-preview .everest-forms-field .everest-forms-field-setting",function(){var t=e(this).closest(".everest-forms-field").attr("data-field-id");i.switchToFieldOptionPanel(t)})}};e(function(){i.init()})}(jQuery,window.evf_data),jQuery(function(){var e=jQuery("#everest-forms-panel-field-settings-redirect_to option:selected").val();"0"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==e&&(jQuery("#everest-forms-panel-field-settings-external_url-wrap").show(),jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide()),jQuery("#everest-forms-panel-field-settings-redirect_to").on("change",function(){"0"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==this.value&&(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").show())}),jQuery("li.evf-panel-field-options-button.evf-disabled-tab").hide()}),jQuery(function(e){e(document.body).on("init_tooltips",function(){e(".tips, .help_tip, .everest-forms-help-tooltip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})}).trigger("init_tooltips"),e(".everest-forms-tab-content").on("click",".everest-forms-add-fields-group > a",function(e){e.preventDefault()}),e(".everest-forms-field-option").on("click",".everest-forms-field-option-group > a",function(t){t.preventDefault(),e(this).parent(".everest-forms-field-option-group").toggleClass("closed").toggleClass("open")}),e(".everest-forms-field-option").on("click",".everest-forms-field-option-group a",function(t){e(t.target).filter(":input, option, .sort").length||e(this).next(".everest-forms-field-option-group-inner").stop().slideToggle()}),e(".everest-forms-field-option-group.closed").each(function(){e(this).find(".everest-forms-field-option-group-inner").hide()})});